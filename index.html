<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="style.css"/>
</head>
<body>
  <div id="calculator-body">
    <div id="display"></div>

    <button id="(">(</button>
    <button id=")">)</button>
    <button id="DEL">DEL</button>
    <button id="AC">AC</button>
    <button id="seven" data-numbers="7">7</button>
    
    <button id="eight" data-numbers="8">8</button>
    <button id="nine" data-numbers="9">9</button>
    <button id="divide" data-operator="÷">÷</button>
    <button id="four" data-numbers="4">4</button>
    <button id="five" data-numbers="5">5</button>
    
    <button id="six" data-numbers="6">6</button>
    <button id="multiply" data-operator="x">x</button>
    <button id="one" data-numbers="1">1</button>
    <button id="two" data-numbers="2">2</button>
    <button id="three" data-numbers="3">3</button>
    
    <button id="subtract" data-operator="-">-</button>
    <button id="zero" data-numbers="0">0</button>
    <button id="decimal">.</button>
    <button id="equal" class="operator">=</button>
    <button id="add"  data-operator="+">+</button>
    

  </div>
</body>
<script src="big.js/big.min.js"></script>
<script>
  const calculatorBody = document.getElementById('calculator-body');
  const digits = document.querySelectorAll('button[data-numbers]');
  const operators = document.querySelectorAll('button[data-operator]');
  const display = document.getElementById('display');
  const equal = document.getElementById('equal');
  const decimal = document.getElementById('decimal');
  const del = document.getElementById('DEL');
  const openingParenthesis = document.getElementById('(');
  const closingParenthesis = document.getElementById(')');
  const allClear = document.getElementById('AC');

  let displayValue = '0';
  updateDisplay(displayValue);

  // Takes an displayValue and returns numberList and operatorList out of
  // the displayValue
  
  // Basic four operations
  function add(num1, num2) {
    return num1 + num2;
  }

  function subtract(num1, num2) {
    return num1 - num2;
  }

  function multiply(num1, num2) {
    return num1 * num2;
  }

  function divide(num1, num2) {
    return num1 / num2;
  }

  // is Decimal? True or False
  function isDecimal(num1) {
  if (num1 % 1 != 0) {
    return true
  } else {
    return false
  }
}

  // is Operator? True or False
  function isOperator(operator) {
  if (
    operator === '+'
    || operator === '-'
    || operator === 'x'
    || operator === '÷'
  ) {
    return true;
  } else {
    return false;
  }
}
  
  // is Multiply or Divide? True or False
  function isMultiplyOrDivide(operator) {
    return (operator == 'x' || operator == '÷') ? true : false;
  }
  
  // Takes one operator, and two numbers and then calls one of the
  // basic operation functions
  function operate(operator, num1, num2) {
    if (operator == '+') {
      return add(num1, num2)
    } else if (operator == '-') {
      return subtract(num1, num2)
    } else if (operator == 'x') {
      return multiply(num1, num2)
    } else if (operator == '÷') {
      return divide(num1, num2)
    }
  }

  // As same as the function 'operate', except this does operation for decimal
  function decimalOperate(operator, num1, num2) {
    let sum = 0
    if (operator == '+') {
      num1 = new Big(num1);
      sum = num1.plus(num2)
      return Number(sum.valueOf())
    } 
    else if (operator == '-') {
      num1 = new Big(num1);
      sum = num1.minus(num2)
      return Number(sum.valueOf())
    } 
    else if (operator == 'x') {
      num1 = new Big(num1);
      sum = num1.times(num2)
      return Number(sum.valueOf())
    } 
    else if (operator == '÷') {
      num1 = new Big(num1);
      sum = num1.div(num2)
      return Number(sum.valueOf())
    }
  }
  
  function returnNumbersAndOperators(displayValue) {
  if (displayValue.length == 0) {
    return displayValue; // return as is
  } else {
    let displayValueArray = displayValue.split('');
    let currentNumber = 0;
    let numberList = [];
    let operatorList = [];

    displayValueArray.forEach((element, index, arr) => {
      
      // if it's a number or a decimal, add to the currentNumber
      if (Number(element)) {
        currentNumber += Number(element);
      } else if(element === '.') {
        currentNumber += element
      }

      // If it's operator, add number and operator to the regarding list
      if(isOperator(element)) {
        currentNumber = Number(currentNumber);
        numberList.push(currentNumber);
        operatorList.push(element);
        currentNumber = 0;
        return;
      }

      // If it's the end of the array, add the current number to the Numbers
      if(index === arr.length - 1) {
        currentNumber = Number(currentNumber);
        numberList.push(currentNumber);
        currentNumber = 0;
      }
    });

    return {
      numberList: numberList,
      operatorList: operatorList,
    };
  } 
} 
  
  // Calculate multiplications and divisions first.
  // This will calculate numbers that has to be calculated
  // with multiplications and divisions only. add and subtraction
  // will be left
  // Returns nothing, just edit numberlist and operatorlist
  function calculateMultiplyAndDivision(numberList, operatorList) {
    numberList = Array.from(numberList);
    operatorList = Array.from(operatorList);
    
    let index = 0;
    let result = 0;
    let currentOperator = '';
    let firstNum = 0;
    let secondNum = 0;
    let operatorListLength = operatorList.length;

    for (let i = 0; i < operatorListLength; i++) {
      result = 0;
      
      currentOperator = operatorList[index];
      firstNum = numberList[index];
      secondNum = numberList[index+1];

      
      if (isMultiplyOrDivide(currentOperator)) {
        if (isDecimal(firstNum) || isDecimal(secondNum)) {
          result = decimalOperate(currentOperator, firstNum, secondNum);
        } else {
          result = operate(currentOperator, firstNum, secondNum);
        }
        numberList.splice(index, 2, result);
        operatorList.splice(index, 1);
      } else {
        // index is incrased, because the operator wasn't 'x' or '/', so that
        // we need to move on to the next element
        index++;
      }
    }

    return {
      numberList: numberList,
      operatorList: operatorList
    };
  }

  // Calculate additions and subtractions. Returns sum
  function calculateAdditionAndSubtraction(numberList, operatorList) {
    // If there's some +, - left in the operatorList
    let firstNum = 0;
    let secondNum = 0;
    let sum = 0;
    let currentOperator = '';

    for(let i = 0; i < operatorList.length; i++) {
      firstNum = numberList[i];
      secondNum = numberList[i+1];
      currentOperator = operatorList[i];

      // For the first operation
      if (i == 0) {
        if(isDecimal(firstNum) || isDecimal(secondNum)) {
          sum = decimalOperate(currentOperator, firstNum, secondNum);  
        } else {
          sum = operate(currentOperator, firstNum, secondNum);
        }
        continue;
      }

      // Since the second operation
      if(isDecimal(firstNum) || isDecimal(secondNum)) {
        sum = decimalOperate(currentOperator, sum, secondNum);
      } else {
        sum = operate(currentOperator, sum, secondNum);
      }
    }

    return sum;
  }

  // Displays the value and operators that has been clicked.
  function updateDisplay(displayValue) {
    display.innerHTML = displayValue;
  }

  // Returns the display Value
  function returnDisplay() {
    return display.innerHTML
  }


  // Event Listeners for all digits
  digits.forEach(digit => {
    digit.addEventListener('click', event => {
      if (displayValue == '0') { // when first starting, replace 0 with input
        displayValue = event.target.getAttribute("data-numbers");
      } else {
        displayValue += event.target.getAttribute("data-numbers");
      }
      updateDisplay(displayValue);
    })
  })
  
  // Event Listeners for four basic operators
  operators.forEach(operator => {
    // let displayValueArray = displayValue.split('');
    // let lastElement = displayValueArray[displayValueArray.length -1];
    
    operator.addEventListener('click', event => {
      // Check if your last value is operator
      displayValue += event.target.getAttribute("data-operator");
      updateDisplay(displayValue);
    })
  })

  openingParenthesis.addEventListener('click', event => {
    displayValue += '(';
    updateDisplay(displayValue);
  })

  closingParenthesis.addEventListener('click', event => {
    displayValue += ')';
    updateDisplay(displayValue);
  })

  decimal.addEventListener('click', event => {
    displayValue += '.';
    updateDisplay(displayValue);
  })

  del.addEventListener('click', event => {
    let splittedDisplayValue = displayValue.split('');
    splittedDisplayValue.pop();
    displayValue = splittedDisplayValue.join('');
    updateDisplay(displayValue);
  })

  allClear.addEventListener('click', event => {
    displayValue = '0';
    updateDisplay(displayValue);
  })

  // If equal is clicked, calculate the all the numbers regarding the operators
  equal.addEventListener('click', event => {
    let sum = 0;
    let numberList = [];
    let operatorList = [];

    console.log(`displayValue: ${displayValue}`);

    let numAndOper = returnNumbersAndOperators(displayValue);
    numberList = numAndOper.numberList;
    operatorList = numAndOper.operatorList;
    console.log('After returnNumbersAndOperators');
    console.log(numberList);
    console.log(operatorList);

    console.log(numberList.length)
    console.log(operatorList.length)

    // When numberList and operatorList don't have the same length, it should
    // run, ex) numberList = [3], operatorList['+']. You can't do operation
    if (numberList.length != operatorList.length) {
      numAndOper = calculateMultiplyAndDivision(numberList, operatorList)
      numberList = numAndOper.numberList;
      operatorList = numAndOper.operatorList;

      if (operatorList.length != 0) { // When there's nothing left in the list
        sum = calculateAdditionAndSubtraction(numberList, operatorList)
        updateDisplay(sum);
      } else { // There's +, - left in the operatorList
        sum = numberList[0];
        updateDisplay(sum);
      }
    } else {
      updateDisplay(displayValue);
    }
    
    
    
    
    

   
    
   
   
  }) // equal.addEventListener

  


</script>

</html>